# –ß–∞—Ç–±–æ—Ç —Å –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–º –ø–æ–∏—Å–∫–æ–º –Ω–∞ Colpali –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –æ—Ç–≤–µ—Ç–æ–≤ —Å–ø–æ–º–æ—â—å—é LLaMA 3.2 Vision 11b


[–°–∞–π—Ç —Ö–∞–∫–∞—Ç–æ–Ω–∞](https://nornickel-hackathon.ru/) 
## –†–µ–∑—É–ª—å—Ç–∞—Ç —Ö–∞–∫–∞—Ç–æ–Ω–∞
–ö–æ–º–∞–Ω–¥–∞ –∑–∞–Ω—è–ª–∞ 3-–µ –º–µ—Å—Ç–æ
![](https://github.com/200-OK-Colpali/chat_front/blob/main/results.jpg)

## üöÄ –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

### –ú–æ—Ç–∏–≤–∞—Ü–∏—è  

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (PDF, DOCX, PPTX, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö —Ç–µ–∫—Å—Ç –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.  

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã  

- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ-—è–∑—ã–∫–æ–≤—ã–º –º–æ–¥–µ–ª—è–º: –ò—Å–ø–æ–ª—å–∑—É—è –º–æ–¥–µ–ª–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ PaliGemma, ColPali –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∑–∞–¥–∞—á–∞–º–∏, –≤–∫–ª—é—á–∞—é—â–∏–º–∏ –∫–∞–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ, —Ç–∞–∫ –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
- –ú–Ω–æ–≥–æ–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏: –í–º–µ—Å—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–±–æ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å—Ö–æ–∂–µ—Å—Ç—å. 
- –ü–æ–∑–¥–Ω–µ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ü–æ–¥–æ–±–Ω–æ ColBERT(Columnar BERT), –º–æ–¥–µ–ª—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ–∏—Å–∫–∞. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Ö–æ—Ä–æ—à—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö. 


### ‚öôÔ∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è 

![Static Image](http://d.zaix.ru/Km79.png)

1. –§–∞–π–ª –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ PDF.
2. PDF-—Ñ–∞–π–ª —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü —Å–æ–∑–¥–∞—é—Ç—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã. 
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.  
4. –ò–∑–≤–ª–µ—á—ë–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ LLM –º–æ–¥–µ–ª—å Llama –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞.

### ‚úÖ –ò—Ç–æ–≥  

–†–µ—à–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ú–æ–¥–µ–ª—å –±—ã–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –∑–∞–¥–∞—á–∞—Ö –ø–æ–∏—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ OCR –∏ –æ–ø–∏—Å–∞–Ω–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞—è –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –Ω–∞–±–æ—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π. –†–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–æ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.


### üåê –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

![GIF Demo](https://github.com/200-OK-Colpali/chat_front/blob/main/Colpali-RAG-demo-ezgif.com-speed.gif)

---

## üîß –û–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫

–ß–∞—Ç–±–æ—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –æ—Ç–≤–µ—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞. –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker –∏ **–ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–≤—É—Ö –º–∞—à–∏–Ω —Å GPU**.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é
–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Å–ª–µ–¥—É–µ—à–∏—Ö –≤–µ—Ä—Å–∏—è—Ö —è–¥—Ä–∞, –ü–û, –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ hardware

1. –í–µ—Ä—Å–∏–∏ —è–¥—Ä–∞, –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
```
Docker version 24.0.7, build afdd53b
NVIDIA Container Runtime Hook version 1.17.2
NVIDIA Driver Version: 535.113.01
CUDA Version: 12.2
Linux COMP 6.2.0-33-generic #33~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Thu Sep  7 10:33:52 UTC 2 x86_64 x86_64 x86_64 GNU/Linux
```

2. –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
```
CPU: Ryzen 1700
RAM: 16GB
GPU: RTX2070 8GB (–º–∞—à–∏–Ω–∞ 1 –¥–ª—è Colpali)
GPU: RTX4090 24GB (–º–∞—à–∏–Ω–∞ 2 –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ LLaMA 3.2)
```

---
### –ó–∞–ø—É—Å–∫

0. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –∏–Ω–¥–µ–∫—Å
   
   a. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞. –ë–∞–∑–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏ —Ö–∞–∫–∞—Ç–æ–Ω–∞. 
   ```
   bash load_files.bash
   ```
   b. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
      1. –ü—Ä–∏–¥—É–º–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
      2. –í —Ñ–∞–π–ª–µ create_new_index.py –ø–æ–º–µ–Ω—è—Ç—å –≤ —Å—Ç—Ä–æ—á–∫–µ index_name="test_index_name" –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ —Å test_index_name –Ω–∞ —Å–≤–æ–µ
      3. –ó–∞–ø—É—Å—Ç–∏—Ç—å create_new_index.py
      4. –í —Ñ–∞–π–ª–µ pipeline.py –Ω–∞–π—Ç–∏ —Å—Ç—Ä–æ—á–∫—É index_path="./global_index" –∏ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ —Å global_index –Ω–∞ —Å–≤–æ–µ
      5. –ì–æ—Ç–æ–≤–æ

1. ‚ùó–í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ `pipelines.py`

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ generate_oollama_response_generator —É–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å 2-–π –º–∞—à–∏–Ω—ã –∏ 3000 –ø–æ—Ä—Ç
url = "http://[—É–∫–∞–∑–∞—Ç—å —Ç—É—Ç –∞–¥—Ä–µ—Å 2 –º–∞—à–∏–Ω—ã]:3000/api/chat"
```
2. –ó–∞–ø—É—Å–∫ –Ω–∞ –º–∞—à–∏–Ω–µ 2
   
```bash
docker run -it --gpus=all -p 3000:11434 --name ollama ollama/ollama:latest
```

3. –ó–∞–ø—É—Å–∫ –Ω–∞ –º–∞—à–∏–Ω–µ 1

```bash
docker build -t=ragsol .
docker run -it --gpus=all -p 8080:8080 --name=ragsol -v=./docs:/app/docs -v ./test_dataset:/app/test_dataset -v=./.byaldi:/app/.byaldi -v ./colpali:/app/colpali ragsol
docker exec -it ragsol bash
```

```bash
streamlit run main.py --server.port=8080  # <- –∑–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–∞ –Ω–∞ 8080 –ø–æ—Ä—Ç—É –Ω–∞ –ª–æ–∫–∞–ª —Ö–æ—Å—Ç–µ
```
^ –Ω–∞ —ç—Ç–æ–º —à–∞–≥–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–∏–∑–∞–π–¥–µ—Ç –∑–∞–≥—Ä—É—Å–∫–∞ colpali –º–æ–¥–µ–ª–∏ ~ 6–ì–± ‚åõÔ∏è –ù—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å...

4. ‚úÖ –ú–æ–∂–Ω–æ –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ http://[–∞–¥—Ä–µ—Å –º–∞—à–∏–Ω—ã 1]:8080

## –§–∞–π–ª—ã

byaldi.zip - https://disk.yandex.ru/d/dF7eBlPtJs9GNA

test_dataset.zip - https://disk.yandex.ru/d/5i24L_kpgaWYJA

colpali.zip - https://disk.yandex.ru/d/jH1ArfcVQ9z7JQ


## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ MIT-–ª–∏—Ü–µ–Ω–∑–∏–∏, –∞ —Ç–∞–∫–∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –ø–æ–¥–ø–∞–¥–∞—é—â–∏–µ –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏—é LLaMA. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø–æ–¥–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏—é LLaMA, —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –µ—ë —É—Å–ª–æ–≤–∏—è–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏. –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π —Å–º–æ—Ç—Ä–∏—Ç–µ [LICENSE_LLAMA](https://huggingface.co/meta-llama/Llama-3.2-11B-Vision).

